var urlIdioma = "Ajax/AjaxIdiomaPerfilEmpresa.aspx", urlPerfilEmpresa = "Ajax/AjaxPerfilEmpresa.aspx", urlPerfil = "../Perfil/AjaxPerfilUsuario.aspx"; const PerfilEmpresa = new Vue({ el: "#PerfilEmpresaVUE", data: { listaIdiomas: [], ListaPerfilEmpresa: [], ListaIndustrias: [], DatosUsuario: [], selectIndustria: 1, selectpais: 1, Nombre: "", Apellido: "", IdPerfilActive: "", Correo: "", CorreoTxt: "", Imagen: "", IdPerfilEmpresa: "", IdPerfilUsuario: "", rol: "", NombreEmpresa: "", NombreEmpresaTitulo: "", IdEmpresa: "", ContactoPrincipal: "", PaisEmpresa: "", Direccion: "", Telefono: "", Industria: "", ImagenEmpresa: "", ValorBase: "", SelectorImagen: [], monedas: [], monedaSel: "a", telNational: "", phoneInput1: "", TotalNotificacionesEmp: 0 }, mounted: function () { this.ValidarSesion(), this.listaIdiomas = this.ObtenerIdiomaPerfilEmpresa(), this.CargarInformacionUsuario(), this.CargarInformacionEmpresa(), this.cargarIndustrias(), this.cargarImagen(), this.CargarInputPaises(), this.CargarMonedas(), this.ConsultarNotificaciones(), this.RecargarNotificaciones() }, methods: { ObtenerIdiomaPerfilEmpresa: function () { var r = "ES"; void 0 != localStorage.getItem("idiomaApp") && (r = localStorage.getItem("idiomaApp")), this.EstablecerIdiomaPerfilEmpresa(r) }, EstablecerIdiomaPerfilEmpresa: function (r) { var a = this; $.post(urlIdioma, { IE: r }, function (r, e) { a.listaIdiomas = JSON.parse(r), console.log(a.listaIdiomas) }) }, CargarInformacionUsuario: function () { var r = this, a = JSON.parse(sessionStorage.getItem("Empresas")); console.log(a), r.DatosUsuario = a, r.Nombre = a[0].Nombre, r.Apellido = a[0].Apellildo, r.Correo = a[0].Correo, r.IdPerfilUsuario = a[0].IdPerfilUsuario, r.IdPerfilEmpresa = a[0].IdPerfilEmpresa, r.IdPerfilActive = a[0].IdPerfilActive, "" != a[0].ImagenPerfil ? r.Imagen = a[0].ImagenPerfil : r.Imagen = "../images/iconos_admin_activeID_Mesa-de-trabajo-1-copia-3.svg", $.post(urlPerfilEmpresa, { option: "ConsultarRolUsuario", IdEmpresa: r.IdPerfilEmpresa, IdperfilUsuario: r.IdPerfilUsuario }, function (a, e) { r.rol = a }) }, CargarInformacionEmpresa: function () { var r = this, a = JSON.parse(sessionStorage.getItem("Empresas")); r.IdPerfilEmpresa = a[0].IdPerfilEmpresa, r.ImagenEmpresa = " ", $.post(urlPerfilEmpresa, { option: "ConsultaPerfil", IdEmpresa: r.IdPerfilEmpresa }, function (a, e) { r.ListaPerfilEmpresa = JSON.parse(a); var i = JSON.parse(a); r.NombreEmpresaTitulo = i[0].Nombre, r.ImagenEmpresa = i[0].Imagen, r.IdEmpresa = i[0].IdEmpresa, r.NombreEmpresa = i[0].Nombre, r.ContactoPrincipal = i[0].ContactoPrincipal, r.Direccion = i[0].Direccion, $("#country1").countrySelect("setCountry", i[0].Pais), r.CorreoTxt = i[0].Correo, r.phoneInput1.setNumber(i[0].Telefono), r.selectIndustria = i[0].Industria, r.selectpais = i[0].Pais, r.monedaSel = i[0].Moneda }) }, cargarIndustrias: function () { var r = this; $.post(urlPerfilEmpresa, { option: "ConsultarIndustrias" }, function (a, e) { var i = JSON.parse(a); r.ListaIndustrias = i }) }, ModificarPerfilEmpresa: function () { var r = this; this.PaisEmpresa = $("#country1").countrySelect("getSelectedCountryData").name; var a = JSON.parse(sessionStorage.getItem("Empresas")); r.IdPerfilEmpresa = a[0].IdPerfilEmpresa, "" == r.IdPerfilEmpresa || "" == r.IdEmpresa ? alertify.error(r.listaIdiomas.DatosIncompletos) : "" == r.NombreEmpresa ? alertas.error(r.listaIdiomas.Atencion, r.listaIdiomas.LlenarNombreEmpresa) : "" == r.ContactoPrincipal ? alertas.error(r.listaIdiomas.Atencion, r.listaIdiomas.LlenarContactoPrincipal) : "" == r.Direccion ? alertas.error(r.listaIdiomas.Atencion, r.listaIdiomas.LlenarDireccion) : "" == r.CorreoTxt ? alertas.error(r.listaIdiomas.Atencion, r.listaIdiomas.LlenarCorreoTxt) : "" == this.phoneInput1.getNumber(intlTelInputUtils.numberFormat.E164) ? alertas.error(r.listaIdiomas.Atencion, r.listaIdiomas.LlenarTelefono) : 0 == r.selectIndustria ? alertas.error(r.listaIdiomas.Atencion, r.listaIdiomas.LlenarIndustria) : "" == this.PaisEmpresa ? alertas.error(r.listaIdiomas.Atencion, r.listaIdiomas.LlenarPais) : $.post(urlPerfilEmpresa, { option: "ActualizarPerfil", NuevoPerfil: JSON.stringify({ IdPerfilEmpresa: r.IdPerfilEmpresa, IdEmpresa: r.IdEmpresa, Nombre: r.NombreEmpresa, ContactoPrincipal: r.ContactoPrincipal, Direccion: r.Direccion, Pais: this.PaisEmpresa, Correo: r.CorreoTxt, Telefono: r.phoneInput1.getNumber(), Industria: r.selectIndustria }) }, function (a, e) { "Actualizado" == a ? alertas.success(r.listaIdiomas.Atencion, r.listaIdiomas.ActualizaOk) : "Correo no v\xe1lido" == a ? alertas.error(r.listaIdiomas.Atencion, r.listaIdiomas.CorreoError) : alertas.error(r.listaIdiomas.Atencion, r.listaIdiomas.ActualizaError) }) }, previewFiles(r) { console.log(r.target.files) }, handleFileSelect: function (r) { var a, e = this, i = r.target.files[0], o = new FileReader; o.onload = function (r) { var a = r.target.result, i = window.btoa(a); e.ValorBase = i, e.cambiarImagen(e.ValorBase, e.IdPerfilEmpresa) }, o.readAsBinaryString(i) }, cambiarImagen: function (r, a) { var e = this; $.post(urlPerfilEmpresa, { option: "CambiarImagen", IdEmpresa: a, Imagen64: r }, function (r, a) { "Ok" == r ? (e.CargarInformacionEmpresa(), alertify.success(e.listaIdiomas.ModificarImagenOk)) : alertify.error(e.listaIdiomas.ModificarImagenError) }) }, cargarImagen: function () { var r = this; r.Imagen = "", $.post(urlPerfil, { opciones: "BuscarImagen", IdUsuario: r.IdPerfilUsuario }, function (a, e) { var i = JSON.parse(a); r.Imagen = i }) }, ValidarSesion: function () { var r = JSON.parse(sessionStorage.getItem("DConfig")), a = JSON.parse(sessionStorage.getItem("DUser")); (null == r || !1 == r.CofPerfil || null == a || 1 != a[0].TipoUsuario) && (window.location.href = window.location.origin + "/AccesoDenegado.aspx") }, click: function () { console.log(this.monedaSel) }, CargarMonedas: function () { var r = this, a = JSON.parse(localStorage.getItem("MonedasJSON")); r.monedas = a }, CargarInputPaises: function () { let r = document.getElementById("telNational"); this.phoneInput1 = window.intlTelInput(r, { initialCountry: "cr", preferredCountries: ["us", "cr"], separateDialCode: !0, autoPlaceholder: "off", utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/11.0.14/js/utils.js" }), $("#country1").countrySelect({ defaultCountry: "cr" }) }, ValidarSoloNumeros() { var r = String.fromCharCode(event.charCode ? event.charCode : event.which); if (!(regex = /^[0-9]$/).test(r)) return event.preventDefault(), !1 }, ConsultarNotificaciones: function () { var r = this; $.post(urlPerfil, { opciones: "ConsultarNotificaciones", IdPerfilActive: r.IdPerfilActive }, function (a, e) { var i = JSON.parse(a); r.TotalNotificacionesEmp = i }) }, RecargarNotificaciones: function () { var r = this; setInterval(function () { r.ConsultarNotificaciones() }, 3e4) } }, watch: {} });